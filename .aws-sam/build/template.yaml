AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Template for the Dwell Well E-commerce application. Orchestrates nested
  stacks for each microservice.
Globals:
  Function:
    Timeout: 30
    MemorySize: 256
    Tracing: Active
    Architectures:
    - x86_64
Resources:
  AuthStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: AuthStack/template.yaml
    Metadata:
      SamResourceId: AuthStack
  CoreStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: CoreStack/template.yaml
      Parameters:
        CognitoUserPoolArn:
          Fn::GetAtt:
          - AuthStack
          - Outputs.CognitoUserPoolArn
    Metadata:
      SamResourceId: CoreStack
  ProductsStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: ProductsStack/template.yaml
    Metadata:
      SamResourceId: ProductsStack
  OrdersStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: OrdersStack/template.yaml
      Parameters:
        AppEventBusName:
          Fn::GetAtt:
          - CoreStack
          - Outputs.AppEventBusName
        ProductsTableName:
          Fn::GetAtt:
          - ProductsStack
          - Outputs.ProductsTableName
    Metadata:
      SamResourceId: OrdersStack
  PaymentsStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: PaymentsStack/template.yaml
      Parameters:
        ProductsTableName:
          Fn::GetAtt:
          - ProductsStack
          - Outputs.ProductsTableName
    Metadata:
      SamResourceId: PaymentsStack
  RatingsStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: RatingsStack/template.yaml
      Parameters:
        AppEventBusName:
          Fn::GetAtt:
          - CoreStack
          - Outputs.AppEventBusName
        ProductsTableName:
          Fn::GetAtt:
          - ProductsStack
          - Outputs.ProductsTableName
    Metadata:
      SamResourceId: RatingsStack
  WebhooksStack:
    Type: AWS::Serverless::Application
    Properties:
      Location: WebhooksStack/template.yaml
      Parameters:
        AppEventBusName:
          Fn::GetAtt:
          - CoreStack
          - Outputs.AppEventBusName
        ProductsTableName:
          Fn::GetAtt:
          - ProductsStack
          - Outputs.ProductsTableName
    Metadata:
      SamResourceId: WebhooksStack
Outputs:
  ApiEndpoint:
    Description: API Gateway endpoint URL
    Value:
      Fn::GetAtt:
      - CoreStack
      - Outputs.ApiEndpoint
  CognitoUserPoolId:
    Description: The ID of the Cognito User Pool
    Value:
      Fn::GetAtt:
      - AuthStack
      - Outputs.CognitoUserPoolId
  CognitoUserPoolClientId:
    Description: The ID of the Cognito User Pool Client
    Value:
      Fn::GetAtt:
      - AuthStack
      - Outputs.CognitoUserPoolClientId
